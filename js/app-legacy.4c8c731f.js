(function(){"use strict";var e={2674:function(e,t,n){n.d(t,{q:function(){return i},u:function(){return r}});var i={apiKey:"AIzaSyCGLXls0uwohW8UczwMuMPgY61QRCyjydA",authDomain:"soter-ia.firebaseapp.com",databaseURL:"https://soter-ia.firebaseio.com",projectId:"soter-ia",storageBucket:"soter-ia.appspot.com",messagingSenderId:"712755300293",appId:"1:712755300293:web:9c91cc4c98e2a36b77edac",measurementId:"G-6Y82RJ5Q37"},r="BLz4hW8tcGGVq3HkDTlruyQO4mW-IfHrG_5cNdkfW8zFfTHAjSXaGIqb4jE63RIWhBsf-ob_7z2X5N6ItZ-phyM"},6176:function(e,t,n){n(6992),n(8674),n(9601),n(7727);var i=n(1146),r=n(9963),o=n(6252);function a(e,t,n,i,a,s){var u=(0,o.up)("Notification"),c=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(r.uT,{name:"notif"},{default:(0,o.w5)((function(){return[e.message?((0,o.wg)(),(0,o.j4)(u,{key:0,message:e.message,onDismiss:t[0]||(t[0]=function(t){return e.message=null})},null,8,["message"])):(0,o.kq)("",!0)]})),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((function(e){var t=e.Component,n=e.route;return[(0,o.Wm)(r.uT,{name:n.meta.transition||"fade",mode:"out-in"},{default:(0,o.w5)((function(){return[((0,o.wg)(),(0,o.j4)((0,o.LL)(t)))]})),_:2},1032,["name"])]})),_:1})],64)}var s=n(8637),u=n(5975),c=n(7627),l=n(26),d=n(9181),f=n(3577),p={id:"notification"},v=["moving"],h={class:"title"},g={class:"body"};function m(e,t,n,i,r,a){return(0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("div",{class:"notification",onTouchmovePassive:t[0]||(t[0]=function(){return e.onTouchMove&&e.onTouchMove.apply(e,arguments)}),onTouchstartPassive:t[1]||(t[1]=function(){return e.onTouchStart&&e.onTouchStart.apply(e,arguments)}),onTouchendPassive:t[2]||(t[2]=function(){return e.onTouchEnd&&e.onTouchEnd.apply(e,arguments)}),style:(0,f.j5)({transform:"translateX(".concat(e.translate,"px)")}),moving:e.moving},[(0,o._)("div",h,(0,f.zw)(e.message.notification.title),1),(0,o._)("div",g,(0,f.zw)(e.message.notification.body),1)],44,v)])}var w=(0,o.aZ)({emits:["dismiss"],props:{message:{type:Object,required:!0}},mounted:function(){var e=this;window&&(this.windowWidth=window.innerWidth,window.addEventListener("resize",(function(t){return e.windowWidth=window.innerWidth})))},data:function(){return{touchStartPoint:[0,0],translate:0,moving:!1,windowWidth:0}},methods:{onTouchMove:function(e){this.translate=e.changedTouches[0].screenX-this.touchStartPoint[0]},onTouchStart:function(e){this.moving=!1,this.touchStartPoint=[e.changedTouches[0].screenX,e.changedTouches[0].screenY]},onTouchEnd:function(e){this.moving=!0;var t=160;this.translate>t?(this.translate=this.windowWidth+1,this.$emit("dismiss")):this.translate<-t?(this.translate=-(this.windowWidth+1),this.$emit("dismiss")):this.translate=0}}}),b=n(3744);const k=(0,b.Z)(w,[["render",m],["__scopeId","data-v-30e8be7d"]]);var y=k,C=(0,o.aZ)({components:{Notification:y},data:function(){var e=null;return{message:e}},created:function(){var e=this;window.addEventListener("beforeinstallprompt",(function(t){e.$store.commit(l.wX,t)}));u.O.getApp();(0,s.oR)(c.J).dispatch(d.LW)},methods:{},watch:{"$store.state.messages.lastMessage":function(e){var t=this;this.message=e,setTimeout((function(){t.message=null}),1e4)}}});const _=(0,b.Z)(C,[["render",a]]);var x=_,A={beforeMount:function(e,t,n){e.clickOutsideEvent=function(n){e===n.target||e.contains(n.target)||t.value(n,e)},document.body.addEventListener("click",e.clickOutsideEvent)},unmounted:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}},T=n(5205);(0,T.z)("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh."),c.h.commit(l.N4)},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n(1539),n(8783),n(3948),n(4916),n(3123);var P=n(2119),E=function(e){return(0,o.dD)("data-v-92b5dd60"),e=e(),(0,o.Cn)(),e},I={id:"home"},Z=E((function(){return(0,o._)("div",{class:"background"},[(0,o._)("div",{class:"header"})],-1)})),z={class:"foreground"},S={class:"header"},U={key:0,class:"activities placeholder",ref:"cards"},D=["data-index"],O=E((function(){return(0,o._)("div",{class:"icon"},[(0,o._)("span",{class:"material-icon"},"sentiment_dissatisfied")],-1)}));function L(e,t,n,i,a,s){var u=(0,o.up)("Settings"),c=(0,o.up)("LeaveCarButton"),l=(0,o.up)("UseCarButton"),d=(0,o.up)("AdminButton");return(0,o.wg)(),(0,o.iD)("div",I,[(0,o.Wm)(u),Z,(0,o._)("div",z,[(0,o._)("div",S,(0,f.zw)(e.headerString),1),e.user?((0,o.wg)(),(0,o.j4)(r.W3,{key:1,tag:"div",class:"activities",name:"cards",appear:""},{default:(0,o.w5)((function(){return[e.usecar?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[e.usingCar?((0,o.wg)(),(0,o.j4)(c,{key:0,"data-index":"1"})):((0,o.wg)(),(0,o.j4)(l,{key:1,"data-index":"1"}))],64)):(0,o.kq)("",!0),e.hasPermission("admin")?((0,o.wg)(),(0,o.j4)(d,{key:1,"data-index":"2"})):(0,o.kq)("",!0),!e.user||e.hasPermission("admin")||e.usecar?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)(o.HY,{key:2},[O,(0,o.Uk)(" "+(0,f.zw)(e.$t.noPermission),1)],64))]})),_:1})):((0,o.wg)(),(0,o.iD)("div",U,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(4,(function(e){return(0,o._)("div",{class:"placeholder_card",key:e,"data-index":e},null,8,D)})),64))],512))])])}var j=n(2833),N=n(3087),M=n(3806),W=n(1481),$=n(655),R=n(1124),q=function(e){return(0,o.dD)("data-v-79094fd2"),e=e(),(0,o.Cn)(),e},B=q((function(){return(0,o._)("span",{class:"material-icon"},"agriculture",-1)}));function G(e,t,n,i,r,a){var s=(0,o.up)("ActivityButton");return(0,o.wg)(),(0,o.j4)(s,{onClick:e.openUseCarPage},{icon:(0,o.w5)((function(){return[B]})),title:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.useCarTitle),1)]})),description:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.useCarDesc),1)]})),_:1},8,["onClick"])}var H={class:"icon"},V={class:"text"},F={class:"title"},X={class:"desciption"};function J(e,t,n,i,r,a){return(0,o.wg)(),(0,o.iD)("div",{class:(0,f.C_)({activity_card:!0,animated:e.animated}),onClick:t[0]||(t[0]=function(){return e.expand&&e.expand.apply(e,arguments)})},[(0,o._)("div",H,[(0,o.WI)(e.$slots,"icon",{},void 0,!0)]),(0,o._)("div",V,[(0,o._)("div",F,[(0,o.WI)(e.$slots,"title",{},void 0,!0)]),(0,o._)("div",X,[(0,o.WI)(e.$slots,"description",{},void 0,!0)])])],2)}var K=(0,o.aZ)({data:function(){return{animated:!1}},methods:{expand:function(){this.animated=!0}}});const Y=(0,b.Z)(K,[["render",J],["__scopeId","data-v-6c855a7a"]]);var Q=Y,ee=(0,o.aZ)({components:{ActivityButton:Q},methods:{openUseCarPage:function(){this.$router.push({path:"usecar"})}}});const te=(0,b.Z)(ee,[["render",G],["__scopeId","data-v-79094fd2"]]);var ne=te,ie=function(e){return(0,o.dD)("data-v-9242d3aa"),e=e(),(0,o.Cn)(),e},re=ie((function(){return(0,o._)("span",{class:"material-icon"},"agriculture",-1)}));function oe(e,t,n,i,r,a){var s=(0,o.up)("ActivityButton");return(0,o.wg)(),(0,o.j4)(s,{onClick:e.openUseCarPage},{icon:(0,o.w5)((function(){return[re]})),title:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.leaveCarTitle),1)]})),description:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.leaveCarDesc),1)]})),_:1},8,["onClick"])}var ae=(0,o.aZ)({components:{ActivityButton:Q},methods:{openUseCarPage:function(){this.$router.push({path:"leavecar"})}}});const se=(0,b.Z)(ae,[["render",oe],["__scopeId","data-v-9242d3aa"]]);var ue=se,ce=function(e){return(0,o.dD)("data-v-a72cec0c"),e=e(),(0,o.Cn)(),e},le=ce((function(){return(0,o._)("span",{class:"material-icon"},"admin_panel_settings",-1)}));function de(e,t,n,i,r,a){var s=(0,o.up)("ActivityButton");return(0,o.wg)(),(0,o.j4)(s,{onClick:e.openUseCarPage},{icon:(0,o.w5)((function(){return[le]})),title:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.adminTitle),1)]})),description:(0,o.w5)((function(){return[(0,o.Uk)((0,f.zw)(e.$t.adminDesc),1)]})),_:1},8,["onClick"])}var fe=(0,o.aZ)({components:{ActivityButton:Q},methods:{openUseCarPage:function(){this.$router.push({path:"admin"})}}});const pe=(0,b.Z)(fe,[["render",de],["__scopeId","data-v-a72cec0c"]]);var ve=pe,he=function(e){return(0,o.dD)("data-v-8809a244"),e=e(),(0,o.Cn)(),e},ge={id:"more_menu"},me=["badge"],we=he((function(){return(0,o._)("span",{class:"material-icon"},"more_vert",-1)})),be=[we],ke={key:0,id:"menu"},ye={class:"text"},Ce={class:"text"},_e=he((function(){return(0,o._)("div",{class:"text"},"Attiva geolocalizzazione",-1)})),xe={class:"switch"},Ae=he((function(){return(0,o._)("span",{class:"slider"},null,-1)})),Te={class:"text"},Pe={class:"version"};function Ee(e,t,n,i,a,s){var u=this,c=(0,o.Q2)("click-outside");return(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",ge,[(0,o._)("div",{id:"menu_btn",onClick:t[0]||(t[0]=function(t){return e.showMenu=!e.showMenu}),badge:e.updateAvailable},be,8,me),e.showMenu?((0,o.wg)(),(0,o.iD)("div",ke,[e.installEv?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"option",onClick:t[1]||(t[1]=function(){return e.installApp&&e.installApp.apply(e,arguments)})},[(0,o._)("div",ye,(0,f.zw)(e.$t.install),1)])):(0,o.kq)("",!0),e.updateAvailable?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"option",onClick:t[2]||(t[2]=function(){return e.updateApp&&e.updateApp.apply(e,arguments)}),badge:"true"},[(0,o._)("div",Ce,(0,f.zw)(e.$t.update),1)])):(0,o.kq)("",!0),(0,o._)("div",{class:"option",onClick:t[4]||(t[4]=function(){return e.toggleGeo&&e.toggleGeo.apply(e,arguments)})},[_e,(0,o._)("div",xe,[(0,o.wy)((0,o._)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=function(e){return u.geoOn=e})},null,512),[[r.e8,this.geoOn]]),Ae])]),(0,o._)("div",{class:"option",onClick:t[5]||(t[5]=function(){return e.logout&&e.logout.apply(e,arguments)})},[(0,o._)("div",Te,(0,f.zw)(e.$t.logout),1)]),(0,o._)("div",Pe,"v"+(0,f.zw)(e.version),1)])):(0,o.kq)("",!0)])),[[c,e.onClickOutside]])}var Ie=(0,j.Z)((function e(t,n){(0,N.Z)(this,e),this.message=t,this.payload=n})),Ze=function(){function e(){(0,N.Z)(this,e),this.watchPositionId=null,this.navigator=navigator}return(0,j.Z)(e,[{key:"startWatchPosition",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enableHighAccuracy:!1,maximumAge:6e4},i=(0,s.oR)(c.J);if(!i.state.settings.geopositionEnabled)throw new Ie("Geoposition disabled!");if(this.stopWatchPosition(),!("geolocation"in this.navigator))throw new Ie("Geoposition not available");this.watchPositionId=this.navigator.geolocation.watchPosition((function(t){e(t)}),(function(e){throw t.watchPositionId&&t.stopWatchPosition(),new Ie("Error getting the position",e)}),n)}},{key:"stopWatchPosition",value:function(){this.watchPositionId&&this.navigator.geolocation.clearWatch(this.watchPositionId)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new this)}}]),e}(),ze=n(6849),Se=n(6322),Ue=(0,o.aZ)({data:function(){var e=!1;return{showMenu:e}},methods:{onClickOutside:function(){this.showMenu=!1},logout:function(){(0,Se.w7)((0,Se.v0)()),this.$router.push("login")},installApp:function(){this.installEv&&this.installEv.prompt()},updateApp:function(){this.updateAvailable&&window.location.reload()},toggleGeo:function(){if(this.$store.commit(ze.s),this.geoOn)try{Ze.getInstance()}catch(e){console.log("Geolocalizzazione non avviata per il seguente errore: ",e),this.$store.commit(ze.s,!1)}else Ze.getInstance().stopWatchPosition()}},computed:{installEv:function(){return this.$store.state.appState.installEvent},updateAvailable:function(){return this.$store.state.appState.updateAvailable},version:function(){return this.$store.state.appState.version},geoOn:function(){return this.$store.state.settings.geopositionEnabled}}});const De=(0,b.Z)(Ue,[["render",Ee],["__scopeId","data-v-8809a244"]]);var Oe=De,Le=function(e){(0,M.Z)(n,e);var t=(0,W.Z)(n);function n(){return(0,N.Z)(this,n),t.apply(this,arguments)}return(0,j.Z)(n)}(R.w3);Le=(0,$.gn)([(0,R.Ei)({components:{UseCarButton:ne,LeaveCarButton:ue,AdminButton:ve,Settings:Oe},mounted:function(){c.h.dispatch(l.VX)},computed:{displayName:function(){var e;return null===(e=(0,s.oR)(c.J).state.firebase.user)||void 0===e?void 0:e.displayName},usingCar:function(){var e;return null===(e=c.h.state.appState.user)||void 0===e?void 0:e.usingCar},usecar:function(){return this.hasPermission("usecar")},headerString:function(){var e=c.h.getters.usedCar;return e?"Come va la ".concat(e.model,"?"):"Ciao".concat(this.displayName?", "+this.displayName:"","!")},user:function(){return c.h.state.appState.user}},methods:{hasPermission:function(e){var t=c.h.state.appState.user;if(t)return null!=t.permissions[e]}}})],Le);var je=Le;const Ne=(0,b.Z)(je,[["render",L],["__scopeId","data-v-92b5dd60"]]);var Me=Ne,We=[{path:"/",name:"Home",component:Me,meta:{requireLogin:!0}},{path:"/login",name:"Login",component:function(){return n.e(811).then(n.bind(n,6811))}},{path:"/usecar",name:"Use car",component:function(){return Promise.all([n.e(520),n.e(514)]).then(n.bind(n,205))},meta:{transition:"expand-card",requireLogin:!0}},{path:"/leavecar",name:"Leave car",component:function(){return Promise.all([n.e(520),n.e(655)]).then(n.bind(n,8184))},meta:{transition:"expand-card",requireLogin:!0}},{path:"/admin",name:"Admin",component:function(){return n.e(806).then(n.bind(n,5176))},meta:{transition:"expand-card",requireLogin:!0},children:[{path:"",component:function(){return n.e(189).then(n.bind(n,4189))},meta:{transition:"expand-card",requireLogin:!0}},{path:"notifications",component:function(){return n.e(954).then(n.bind(n,3954))},meta:{transition:"slide",requireLogin:!0}},{path:"notifications/newTopic",component:function(){return n.e(376).then(n.bind(n,376))},meta:{transition:"slide",requireLogin:!0}}]}],$e=(0,P.p7)({history:(0,P.r5)(),routes:We});$e.beforeEach((function(e,t){if(e.meta.requireLogin&&!c.h.state.firebase.user)return{path:"/login",query:{redirect:e.fullPath}}})),$e.afterEach((function(e,t){var n=e.path.split("/").length,i=t.path.split("/").length;"slide"===e.meta.transition?e.meta.transition=n<i?"slide-right":"slide-left":n===i||"slide-right"!==t.meta.transition&&"slide-left"!==t.meta.transition||(e.meta.transition=n<i?"slide-right":"slide-left")}));var Re=$e,qe={useCarTitle:"Utilizza parco auto",useCarDesc:"Registra gli spostamenti dei mezzi dell'associazione",chooseCar:"Scegli mezzo",causal:"Motivo dello spostamento",startOdometer:"Contachilometri alla partenza",useCarBtn:"Prendi",leaveCarTitle:"Lascia macchina",leaveCarDesc:"Chiudi e registra report spostamento",stopOdometer:"Contachilometri finale",declarations:"Qualcosa da dichiarare?",leaveCarBtn:"Lascia",adminTitle:"Pannello di amministrazione",adminDesc:"Gestione riservata al direttivo",csvDownloadDesc:"Non puoi ancora fare granché ma per il momento puoi scaricare il csv dei report",csvDownloadBtn:"Scarica CSV",noPermission:"Sembra che tu non abbia alcun permesso. Chiedi ad uno degli amministratori di configurare il tuo profilo o effettua il logout (menú in alto a destra)",loginDesc:"Per usare quest'app devi essere loggato. Per loggarti devi avere un account Google. Verrano presi dal tuo account solo nome ed indirizzo mail per la gestione dei permessi",loginTitle:"Protezione civile gruppo lucano Tricarico",loginWithGoogle:"Accedi con Google",logout:"Effettua logout",install:"Installa app",update:"Aggiorna app",notificationDesc:"Invia una notifica ad un gruppo di iscritti",goToAdminPush:"Invia notifica",sendNotification:"Invia",sendingNotification:"Inviando...",title:"Titolo",description:"Description",users:"Utenti",topic:"Topic",newTopic:"Crea topic"},Be=(0,r.ri)(x).use(c.h,c.J).use(Re).directive("click-outside",A),Ge=qe;(0,i.KL)();Be.config.globalProperties.$t=Ge,Be.config.globalProperties.$store=c.h,Be.mount("#app"),console.log("v0.3.0-dev0"),c.h.commit(l.b0,"0.3.0-dev0")},8907:function(e,t,n){n.d(t,{B:function(){return u}});var i=n(8534),r=n(3087),o=n(2833),a=(n(5666),n(7663)),s=n(5975),u=function(){function e(){(0,r.Z)(this,e),this.firebase=s.O.getApp(),this.db=(0,a.N8)()}return(0,o.Z)(e,[{key:"readData",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,a.U2)((0,a.iU)((0,a.iH)(this.db),t));case 3:if(n=e.sent,!n.exists()){e.next=8;break}return e.abrupt("return",n.val());case 8:return console.log("No data available"),e.abrupt("return",null);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e["catch"](0),console.log(e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"writeData",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,a.t8)((0,a.iH)(this.db,t),n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"listenForChanges",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=(0,a.iH)(this.db,t),(0,a.jM)(i,(function(e){var t=e.val();n(t)}));case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateValues",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:(0,a.Vx)((0,a.iH)(this.db),t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}()},5975:function(e,t,n){n.d(t,{O:function(){return u}});var i=n(3087),r=n(2833),o=n(2674),a=n(5503),s=n(6690),u=function(){function e(){(0,i.Z)(this,e),this.app=(0,a.ZF)(o.q),(0,s.v0)()}return(0,r.Z)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new this),e.instance}},{key:"getApp",value:function(){return e.getInstance().app}}]),e}()},7627:function(e,t,n){n.d(t,{J:function(){return u},h:function(){return c}});n(2526),n(1817),n(1539);var i=n(8637),r=n(26),o=n(9181),a=n(8802),s=n(6849),u=Symbol(),c=(0,i.MT)({modules:{firebase:o.Uu,appState:r.FH,messages:a.i,settings:s.a}})},26:function(e,t,n){n.d(t,{VX:function(){return h},In:function(){return g},wX:function(){return m},N4:function(){return w},b0:function(){return b},FH:function(){return v}});var i=n(8534),r=n(5082),o=(n(5666),n(2479),n(6699),n(2023),n(7941),n(8309),n(9826),n(1539),n(8907)),a=n(2482),s=n(3087),u=n(2833),c=(n(2222),n(2674)),l=n(1146),d=function(){function e(){(0,s.Z)(this,e),this.db=new o.B}return(0,u.Z)(e,[{key:"saveNoticationToken",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=(0,a.Z)({},"/users/".concat(n,"/notificationTokens/").concat(t),!0),e.prev=1,e.next=4,this.db.updateValues(i);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getMessagingToken",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,l.KL)(),e.next=4,(0,l.LP)(t,{vapidKey:c.u});case 4:if(n=e.sent,!n){e.next=9;break}return e.abrupt("return",n);case 9:console.log("No registration token available. Request permission to generate one.");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](0),console.error("An error occurred while retrieving token. ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveUserInfo",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=(0,a.Z)({},"/users/".concat(t,"/info"),n),e.prev=1,e.next=4,this.db.updateValues(i);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}(),f=n(8802),p=new o.B,v={state:{cars:null,user:null,installEvent:null,updateAvailable:!1,version:null},mutations:{updateCars:function(e,t){e.cars=t},updateUser:function(e,t){e.user=(0,r.Z)({},t)},setInstallEvent:function(e,t){e.installEvent=t},setUpdateAvailable:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.updateAvailable=t},setVersion:function(e,t){e.version=t}},actions:{listenCars:function(e){var t=e.commit;p.listenForChanges("cars",(function(e){return t("updateCars",Object.values(e))}))},listenUser:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n,i,r,o,a,s,u,c,l,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,o=t.rootState,a=t.dispatch,e.next=3,p.readData("users/".concat(null===(n=o.firebase.user)||void 0===n?void 0:n.uid));case 3:if(s=e.sent,!s){e.next=20;break}return r("updateUser",s),u=new d,e.next=9,u.getMessagingToken();case 9:if(c=e.sent,a(f.u),l=o.firebase.user,!l){e.next=20;break}if(v=l.uid,!c||s.notificationTokens&&Object.keys(s.notificationTokens).includes(c)){e.next=17;break}return e.next=17,u.saveNoticationToken(c,v);case 17:if(!l.displayName||!l.email||s.info&&(s.info.name===l.displayName||s.info.mail===l.email)){e.next=20;break}return e.next=20,u.saveUserInfo(v,{name:l.displayName,mail:l.email});case 20:p.listenForChanges("users/".concat(null===(i=o.firebase.user)||void 0===i?void 0:i.uid),(function(e){return r("updateUser",e)}));case 21:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},getters:{carByPlate:function(e){return function(t){return e.cars?e.cars.find((function(e){return e.plate===t})):null}},usedCar:function(e){return e.cars&&e.user?e.cars.find((function(t){var n;return t.plate===(null===(n=e.user)||void 0===n?void 0:n.car)})):null},permissions:function(e){return e.user?Object.keys(e.user.permissions):[]},notificationTokens:function(e){return e.user&&e.user.notificationTokens?Object.keys(e.user.notificationTokens):[]}}},h="listenCars",g="listenUser",m="setInstallEvent",w="setUpdateAvailable",b="setVersion"},9181:function(e,t,n){n.d(t,{LW:function(){return u},Uu:function(){return a}});var i=n(6690),r=n(9932),o=n(26),a={state:{app:null,user:(0,r.a5)("user",null)},mutations:{setApp:function(e,t){e.app=t},setUser:(0,r.Gi)("user",(function(e,t){e.user=t}))},actions:{listenUserAuth:function(e){var t=e.commit,n=e.dispatch,r=(0,i.v0)();(0,i.Aj)(r,(function(e){e?(t(s,e),n(o.In)):t(s,null)}))}}},s="setUser",u="listenUserAuth"},8802:function(e,t,n){n.d(t,{i:function(){return o},u:function(){return a}});var i=n(8534),r=(n(5666),n(1146)),o={state:{messages:[],lastMessage:null},mutations:{addMessage:function(e,t){e.messages.push(t)},updateLastMessage:function(e,t){e.lastMessage=t}},actions:{listenMessages:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.commit,(0,r.ps)((0,r.KL)(),(function(e){console.log(e),n("addMessage",e),n("updateLastMessage",e)}));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},getters:{}},a="listenMessages"},6849:function(e,t,n){n.d(t,{a:function(){return r},s:function(){return o}});var i=n(9932),r={state:{geopositionEnabled:(0,i.a5)("geopositionEnabled",!1)},mutations:{toggleGeoposition:(0,i.Gi)("geopositionEnabled",(function(e,t){e.geopositionEnabled=null!=t?t:!e.geopositionEnabled}))}},o="toggleGeoposition"},9932:function(e,t,n){n.d(t,{Gi:function(){return i},a5:function(){return r}});n(8862);function i(e,t){var n=t,i=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];var o=i[0],a=i[1];n(o,a);var s=JSON.stringify(o[e]);localStorage.setItem(e,s)};return i}function r(e,t){var n=JSON.parse(localStorage.getItem(e));return n||t}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,i,r,o){if(!i){var a=1/0;for(l=0;l<e.length;l++){i=e[l][0],r=e[l][1],o=e[l][2];for(var s=!0,u=0;u<i.length;u++)(!1&o||a>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[u])}))?i.splice(u--,1):(s=!1,o<a&&(a=o));if(s){e.splice(l--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[i,r,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,i){return n.f[i](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/"+e+"-legacy."+{189:"e9d31716",376:"b9b3702c",514:"307c236c",520:"e89e1224",655:"7ee76e6f",806:"808d93b2",811:"50affee8",954:"74e64f44"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/"+e+"."+{189:"1ff5327c",376:"9905b316",514:"a5d32d39",655:"a5d32d39",806:"f72cbd70",811:"ccca0348",954:"c804b26d"}[e]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="protezione-civile:";n.l=function(i,r,o,a){if(e[i])e[i].push(r);else{var s,u;if(void 0!==o)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(u=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=i),e[i]=[r];var f=function(t,n){s.onerror=s.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(e){return e(n)})),t)return t(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){var e=function(e,t,n,i){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css";var o=function(o){if(r.onerror=r.onload=null,"load"===o.type)n();else{var a=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.href||t,u=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");u.code="CSS_CHUNK_LOAD_FAILED",u.type=a,u.request=s,r.parentNode.removeChild(r),i(u)}};return r.onerror=r.onload=o,r.href=t,document.head.appendChild(r),r},t=function(e,t){for(var n=document.getElementsByTagName("link"),i=0;i<n.length;i++){var r=n[i],o=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(o===e||o===t))return r}var a=document.getElementsByTagName("style");for(i=0;i<a.length;i++){r=a[i],o=r.getAttribute("data-href");if(o===e||o===t)return r}},i=function(i){return new Promise((function(r,o){var a=n.miniCssF(i),s=n.p+a;if(t(a,s))return r();e(i,s,r,o)}))},r={143:0};n.f.miniCss=function(e,t){var n={189:1,376:1,514:1,655:1,806:1,811:1,954:1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=i(e).then((function(){r[e]=0}),(function(t){throw delete r[e],t})))}}(),function(){var e={143:0};n.f.j=function(t,i){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise((function(n,i){r=e[t]=[n,i]}));i.push(r[2]=o);var a=n.p+n.u(t),s=new Error,u=function(i){if(n.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,r[1](s)}};n.l(a,u,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,o,a=i[0],s=i[1],u=i[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(u)var l=u(n)}for(t&&t(i);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},i=self["webpackChunkprotezione_civile"]=self["webpackChunkprotezione_civile"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(6176)}));i=n.O(i)})();
//# sourceMappingURL=app-legacy.4c8c731f.js.map