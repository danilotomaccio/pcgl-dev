{"version":3,"file":"js/src_services_AdminService_ts-src_services_NotificationService_ts-legacy.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAEO,IAAMC,YAAb;AAGI;AAEA;AAAA;;AACI,SAAKC,EAAL,GAAU,IAAIF,kEAAJ,EAAV,CADJ,CAEI;AACH;;AARL;AAAA;AAAA;AAAA,yNAUI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACsB,KAAKE,EAAL,CAAQC,QAAR,CAA0C,OAA1C,CADtB;;AAAA;AACUC,mBADV;AAEUC,qBAFV,GAEkB,EAFlB;;AAGI,oBAAID,GAAJ,EAAS;AACL,uBAAWE,GAAX,IAAkBF,GAAlB,EAAuB;AACbG,wBADa,qTACDH,GAAG,CAACE,GAAD,CADF;AACSA,yBAAG,EAAHA;AADT;AAEnBD,yBAAK,CAACG,IAAN,CAAWD,IAAX;AACH;AACJ;;AARL,iDASWF,KATX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAVJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0NAsBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACsB,KAAKH,EAAL,CAAQC,QAAR,CAA4C,sBAA5C,CADtB;;AAAA;AACUC,mBADV;;AAAA,qBAEQA,GAFR;AAAA;AAAA;AAAA;;AAAA,kDAGeK,MAAM,CAACC,IAAP,CAAYN,GAAZ,CAHf;;AAAA;AAAA,kDAKW,EALX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAtBJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yNA8BI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACwB,KAAKF,EAAL,CAAQC,QAAR,CAAiD,aAAjD,CADxB;;AAAA;AACUQ,qBADV;AAEUC,8BAFV,GAEyD,EAFzD;;AAGI,oBAAID,KAAJ,EAAW;AACP,uBAAWE,IAAX,IAAmBF,KAAnB,EAA0B;AACtBC,kCAAc,CAACC,IAAD,CAAd,GAAuBJ,MAAM,CAACC,IAAP,CAAYC,KAAK,CAACE,IAAD,CAAjB,CAAvB;AACH;AACJ;;AAPL,kDAQWD,cARX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA9BJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,WAyCI,4BAAmBP,KAAnB,EAAgC;AAC5B,aAAOA,KAAK,CAACS,OAAN,CAAc,UAACP,IAAD,EAAS;AAC1B,YAAIA,IAAI,CAACQ,kBAAT,EAA6B;AACzB,iBAAON,MAAM,CAACC,IAAP,CAAYH,IAAI,CAACQ,kBAAjB,CAAP;AACH;AACJ,OAJM,CAAP;AAKH;AA/CL;AAAA;AAAA;AAAA,uNAiDI,kBAAgBC,KAAhB,EAA+BC,MAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AACUC,wBADV,GACgDD,MAAM,CAACE,MAAP,CACxC,UAACC,IAAD,EAAkCC,CAAlC;AAAA,gLAAC,2JAA6CD,IAA9C,mKAAqDC,CAArD,EAAyD,IAAzD;AAAA,iBADwC,EAC0B,EAD1B,CADhD;AAII,qBAAKnB,EAAL,CAAQoB,SAAR,gCAAqEN,KAArE,GAA8EE,QAA9E;;AAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAjDJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACDO,IAAMK,mBAAb;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,8NAEI,iBAAuBC,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AACUC,yBADV,GACsB,IAAIC,OAAJ,EADtB;AAEID,yBAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AAEMC,mBAJV,GAIgBC,IAAI,CAACC,SAAL,CAAeN,OAAf,CAJhB;AAMUO,8BANV,GAM2B;AACnBC,wBAAM,EAAE,MADW;AAEnBC,yBAAO,EAAER,SAFU;AAGnBS,sBAAI,EAAEN;AAHa,iBAN3B;AAAA;AAAA,uBAYsBO,KAAK,CAAC,qEAAD,EAAwEJ,cAAxE,CAZ3B;;AAAA;AAYU3B,mBAZV;AAAA;AAAA,uBAaiBA,GAAG,CAACgC,IAAJ,EAbjB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAFJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wNAmBI,kBAAiBnB,MAAjB,EAAmCD,KAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AACUS,yBADV,GACsB,IAAIC,OAAJ,EADtB;AAEID,yBAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AAEMC,mBAJV,GAIgBC,IAAI,CAACC,SAAL,CAAe;AAACb,wBAAM,EAANA,MAAD;AAASD,uBAAK,EAALA;AAAT,iBAAf,CAJhB;AAMUe,8BANV,GAM2B;AACnBC,wBAAM,EAAE,MADW;AAEnBC,yBAAO,EAAER,SAFU;AAGnBS,sBAAI,EAAEN;AAHa,iBAN3B;AAAA;AAAA,uBAYsBO,KAAK,CAAC,2EAAD,EAA8EJ,cAA9E,CAZ3B;;AAAA;AAYU3B,mBAZV;AAAA;AAAA,uBAaiBA,GAAG,CAACgC,IAAJ,EAbjB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAnBJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;;;;ACFa;AACb,aAAa,mBAAO,CAAC,uEAAqB;AAC1C,cAAc,mBAAO,CAAC,2EAAuB;AAC7C,wBAAwB,mBAAO,CAAC,mGAAmC;AACnE,WAAW,mBAAO,CAAC,qGAAoC;;AAEvD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;ACnCa;AACb,QAAQ,mBAAO,CAAC,uEAAqB;AACrC,uBAAuB,mBAAO,CAAC,+FAAiC;AAChE,gBAAgB,mBAAO,CAAC,+EAAyB;AACjD,eAAe,mBAAO,CAAC,6EAAwB;AAC/C,wBAAwB,mBAAO,CAAC,mGAAmC;AACnE,yBAAyB,mBAAO,CAAC,mGAAmC;;AAEpE;AACA;AACA,IAAI,8BAA8B;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;ACpBD;AACA;AACA,uBAAuB,mBAAO,CAAC,+FAAiC;;AAEhE;AACA","sources":["webpack://protezione-civile/./src/services/AdminService.ts","webpack://protezione-civile/./src/services/NotificationService.ts","webpack://protezione-civile/./node_modules/core-js/internals/flatten-into-array.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.flat-map.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.unscopables.flat-map.js"],"sourcesContent":["import { User } from \"@/model/User\";\nimport { FirebaseDBService } from \"./FirebaseDBService\"\n\nexport class AdminService {\n\n    private db: FirebaseDBService;\n    // private store: Store<RootState>;\n\n    constructor() {\n        this.db = new FirebaseDBService();\n        // this.store = store;\n    }\n\n    async getAllUsers() {\n        const res = await this.db.readData<{ [uid: string]: User }>('users');\n        const users = [];\n        if (res) {\n            for (const uid in res) {\n                const user = { ...res[uid], uid };\n                users.push(user);\n            }\n        }\n        return users;\n    }\n\n    async getAllTopics() {\n        const res = await this.db.readData<{ [topic: string]: true }>('notifications/topics');\n        if (res) {\n            return Object.keys(res);\n        }\n        return [];\n    }\n\n    async getAllRoles(): Promise<{ [role: string]: string[]; }> {\n        const roles = await this.db.readData<{ [role: string]: Permission }>('permissions');\n        const formattedRoles: { [role: string]: string[] } = {};\n        if (roles) {\n            for (const role in roles) {\n                formattedRoles[role] = Object.keys(roles[role]);\n            }\n        }\n        return formattedRoles;\n    }\n\n    getTokensFromUsers(users: User[]) {\n        return users.flatMap((user) => {\n            if (user.notificationTokens) {\n                return Object.keys(user.notificationTokens);\n            }\n        });\n    }\n\n    async saveTopic(topic: string, tokens: string[]) {\n        const topicObj: { [topic: string]: true } = tokens.reduce(\n            (tObj: { [topic: string]: true }, t) => ({ ...tObj, [t]: true }), {}\n        );\n        this.db.writeData<{ [topic: string]: true }>(`notifications/topics/${topic}`, topicObj);\n    }\n\n}\n\nexport type Permission = {\n    [uid: string]: true;\n}\n","import { Message } from \"@/model/FcmMessage\";\n\nexport class NotificationService {\n\n    async sendNotification(message: Message) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n\n        const raw = JSON.stringify(message);\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n\n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/send\", requestOptions);\n        return await res.json();\n        \n    }\n    \n    async addToTopic(tokens: string[], topic: string) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        \n        const raw = JSON.stringify({tokens, topic});\n        \n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n        \n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic\", requestOptions);\n        return await res.json();\n    }\n}","'use strict';\nvar global = require('../internals/global');\nvar isArray = require('../internals/is-array');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar bind = require('../internals/function-bind-context');\n\nvar TypeError = global.TypeError;\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg) : false;\n  var element, elementLen;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        elementLen = lengthOfArrayLike(element);\n        targetIndex = flattenIntoArray(target, original, element, elementLen, targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A;\n    aCallable(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n"],"names":["FirebaseDBService","AdminService","db","readData","res","users","uid","user","push","Object","keys","roles","formattedRoles","role","flatMap","notificationTokens","topic","tokens","topicObj","reduce","tObj","t","writeData","NotificationService","message","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","fetch","json"],"sourceRoot":""}